<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>02: Fetch Data - HyperFixi Examples</title>
    <link rel="stylesheet" href="../gallery.css">
    <style>
        /* Example-specific styles */
        button.loading {
            opacity: 0.6;
            cursor: wait;
        }

        .user-card {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
            padding: 25px;
            border-radius: 12px;
            margin: 20px 0;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }

        .user-card h3 {
            margin: 0 0 10px 0;
            font-size: 24px;
        }

        .user-card p {
            margin: 5px 0;
            opacity: 0.95;
        }

        .loading-spinner {
            display: none;
            text-align: center;
            padding: 40px;
            font-size: 48px;
            animation: spin 1s linear infinite;
        }

        .loading-spinner.show {
            display: block;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .data-list {
            max-height: 400px;
            overflow-y: auto;
        }

        .list-item {
            background: var(--panel-muted);
            padding: 15px;
            margin: 10px 0;
            border-radius: 8px;
            border-left: 4px solid var(--accent-primary);
            text-align: left;
        }

        .list-item:hover {
            background: var(--border-light);
        }

        .list-item h4 {
            margin: 0 0 5px 0;
            color: var(--text-light);
        }

        .list-item p {
            margin: 0;
            color: var(--text-muted);
            font-size: 14px;
        }

        .error-box {
            background: #ffebee;
            color: #c62828;
            padding: 15px;
            border-radius: 8px;
            border-left: 4px solid #f44336;
            display: none;
        }

        .error-box.show {
            display: block;
        }
    </style>
</head>
<body class="example-page">
    <div class="page-container">
        <div class="breadcrumb">
            <a href="../index.html">‚Üê Back to Gallery</a> / <strong>Intermediate</strong> / 02: Fetch Data
        </div>

        <h1>üåê Fetch Data from APIs</h1>

        <div class="description">
            <strong>Load data from external APIs dynamically</strong><br>
            HyperFixi now supports the native <code>fetch URL as json</code> syntax! You can also use the <code>call fetch()</code> method with JavaScript's Fetch API.
            <br><br>
            <strong>Two Methods:</strong>
            <ul style="margin: 10px 0;">
                <li><strong>Native:</strong> <code>fetch 'URL' as json</code> - Built-in HyperFixi syntax</li>
                <li><strong>Alternative:</strong> <code>call fetch('URL').then(r => r.json())</code> - JavaScript Fetch API</li>
            </ul>
        </div>

        <div>
            <span class="tag">call</span>
            <span class="tag">fetch</span>
            <span class="tag">JSON</span>
            <span class="tag">async</span>
        </div>

        <!-- Demo 0: Native Fetch Syntax -->
        <div class="demo">
            <h2>Demo 0: Native Fetch Syntax (HyperFixi)</h2>
            <p>Test the built-in <code>fetch URL as json</code> syntax:</p>

            <button
                id="fetch-native-btn"
                _="on click
                   add .loading to me
                   fetch 'https://jsonplaceholder.typicode.com/todos/1' as json
                   log 'Fetch result:', it
                   log 'typeof it:', (typeof it)
                   put it into todoData
                   log 'todoData:', todoData
                   put `<h3>Todo #${todoData.id}</h3>
                        <p>Title: ${todoData.title}</p>
                        <p>Completed: ${todoData.completed ? '‚úÖ' : '‚ùå'}</p>` into #native-output
                   remove .loading from me"
            >
                Test Native Fetch
            </button>

            <div id="native-output"></div>
        </div>

        <!-- Demo 1: Fetch User -->
        <div class="demo">
            <h2>Demo 1: Fetch User Data</h2>
            <p>Click the button to load a random user from JSONPlaceholder API:</p>

            <button
                id="fetch-user-btn"
                _="on click
                   add .loading to me
                   show #spinner
                   hide #user-data
                   fetch 'https://jsonplaceholder.typicode.com/users/1' as json
                   put it into userData
                   put `<h3>${userData.name}</h3>
                        <p>üìß ${userData.email}</p>
                        <p>üè¢ ${userData.company.name}</p>
                        <p>üìç ${userData.address.city}, ${userData.address.street}</p>
                        <p>üìû ${userData.phone}</p>` into #user-data
                   hide #spinner
                   show #user-data
                   remove .loading from me"
            >
                Load User Data
            </button>

            <div id="spinner" class="loading-spinner">‚è≥</div>
            <div id="user-data"></div>
        </div>

        <!-- Demo 2: Fetch Posts List -->
        <div class="demo">
            <h2>Demo 2: Load Blog Posts</h2>
            <p>Load a list of posts from the API:</p>

            <button
                _="on click
                   add .loading to me
                   show #posts-spinner
                   hide #posts-list
                   fetch 'https://jsonplaceholder.typicode.com/posts?_limit=5' as json
                   put it into posts
                   set html to ''
                   repeat for post in posts
                     set html to html + `<div class='list-item'>
                       <h4>${post.title}</h4>
                       <p>${post.body}</p>
                     </div>`
                   end
                   put html into #posts-list
                   hide #posts-spinner
                   show #posts-list
                   remove .loading from me"
            >
                Load Posts
            </button>

            <div id="posts-spinner" class="loading-spinner">‚è≥</div>
            <div id="posts-list" class="data-list"></div>
        </div>

        <!-- Demo 3: Error Handling -->
        <div class="demo">
            <h2>Demo 3: Error Handling</h2>
            <p>Try fetching from an invalid endpoint to see error handling:</p>

            <button
                _="on click
                   hide #error-box
                   add .loading to me
                   fetch 'https://jsonplaceholder.typicode.com/invalid' as json
                   log 'Response:', it
                   if it == null or (Object.keys(it).length == 0)
                     put 'Failed to load data: Resource not found' into #error-message
                     show #error-box
                   else
                     log 'Success:', it
                   end
                   remove .loading from me"
            >
                Test Error Handling
            </button>

            <div id="error-box" class="error-box">
                <strong>‚ùå Error:</strong>
                <span id="error-message"></span>
            </div>
        </div>

        <!-- Code Explanation -->
        <h2>The Code</h2>

        <h3>Basic Fetch:</h3>
        <div class="code">
&lt;button <span class="keyword">_</span>=<span class="string">"on click
        fetch 'https://api.example.com/data' as json
        put it into #output"</span>&gt;
  Load Data
&lt;/button&gt;
        </div>

        <h3>With Loading State:</h3>
        <div class="code">
&lt;button <span class="keyword">_</span>=<span class="string">"on click
        add .loading to me
        show #spinner
        fetch 'https://api.example.com/users' as json
        put it into userData
        <span class="comment">-- Process the data</span>
        hide #spinner
        remove .loading from me"</span>&gt;
  Fetch
&lt;/button&gt;
        </div>

        <h3>Loop Through Results:</h3>
        <div class="code">
&lt;button <span class="keyword">_</span>=<span class="string">"on click
        fetch 'https://api.example.com/posts' as json
        put it into posts
        set html to ''
        repeat for post in posts
          set html to html + `&lt;div&gt;${post.title}&lt;/div&gt;`
        end
        put html into #list"</span>&gt;
  Load Posts
&lt;/button&gt;
        </div>

        <h3>Error Handling:</h3>
        <div class="code">
&lt;button <span class="keyword">_</span>=<span class="string">"on click
        fetch 'https://api.example.com/data' as json
        if it == null
          put 'Error: Failed to load data' into #error-message
          show #error-box
        else
          put it into #output
        end"</span>&gt;
  Load
&lt;/button&gt;
        </div>

        <div class="explanation">
            <h3>How it works:</h3>
            <ul>
                <li><code>fetch 'URL' as json</code> - Built-in HyperFixi fetch command</li>
                <li><code>put it into variable</code> - Store the parsed response data</li>
                <li><code>fetch</code> command - Automatically waits for the request to complete</li>
                <li><code>repeat for item in items</code> - Loops through array results</li>
                <li><code>if it == null</code> - Check for failed requests</li>
                <li>Template literals (<code>`${variable}`</code>) - Embed data in HTML</li>
            </ul>

            <h3>Key Concepts:</h3>
            <ul>
                <li><strong>Fetch Command:</strong> Native syntax: <code>fetch 'URL' as json</code></li>
                <li><strong>Response Type:</strong> Use <code>as json</code>, <code>as html</code>, or <code>as text</code></li>
                <li><strong>Promise Handling:</strong> Fetch automatically waits for the request</li>
                <li><strong>Result Variable:</strong> <code>it</code> contains the parsed response data directly</li>
                <li><strong>Template Literals:</strong> Use backticks for string interpolation</li>
                <li><strong>Error Handling:</strong> Check <code>if it == null</code> for failed requests</li>
            </ul>

            <h3>Response Type Options:</h3>
            <ul>
                <li><code>fetch 'URL' as json</code> - Parse JSON response</li>
                <li><code>fetch 'URL' as text</code> - Get plain text response</li>
                <li><code>fetch 'URL' as html</code> - Parse HTML fragment</li>
                <li><code>fetch 'URL' as response</code> - Get raw Response object</li>
            </ul>

            <h3>HTTP Methods (with options):</h3>
            <div class="code">
<span class="comment">&lt;!-- POST request --&gt;</span>
fetch '/api/users' as json with {
  method: 'POST',
  headers: { 'Content-Type': 'application/json' },
  body: JSON.stringify({ name: 'John', email: 'john@example.com' })
}
put it into newUser

<span class="comment">&lt;!-- PUT request --&gt;</span>
fetch '/api/users/1' as json with {
  method: 'PUT',
  body: JSON.stringify({ name: 'Updated Name' })
}
put it into updatedUser

<span class="comment">&lt;!-- DELETE request --&gt;</span>
fetch '/api/users/1' with { method: 'DELETE' }
log 'User deleted'
            </div>

            <h3>Common Use Cases:</h3>
            <ul>
                <li><strong>Load User Data:</strong> Fetch and display profile information</li>
                <li><strong>Blog Posts:</strong> Load and render article lists</li>
                <li><strong>Search Results:</strong> Fetch filtered data based on input</li>
                <li><strong>Form Submission:</strong> POST data to server</li>
                <li><strong>Auto-complete:</strong> Fetch suggestions as user types</li>
                <li><strong>Pagination:</strong> Load more items on button click</li>
            </ul>

            <h3>Try it yourself:</h3>
            <ul>
                <li>Add search functionality that fetches based on input</li>
                <li>Implement pagination (load more button)</li>
                <li>Create a real-time search with debouncing</li>
                <li>POST form data to an API endpoint</li>
                <li>Add authentication headers to requests</li>
            </ul>
        </div>

        <!-- Navigation -->
        <div class="nav-buttons">
            <a href="01-form-validation.html">‚Üê Previous: Form Validation</a>
            <a href="03-fade-effects.html">Next: Fade Effects ‚Üí</a>
        </div>
    </div>

    <!-- Load HyperFixi -->
    <script src="../../packages/core/dist/hyperfixi-browser.js"></script>
    <script src="../debug-panel.js"></script>
</body>
</html>
