<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sortable Test 6: Edge Cases</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            padding: 2rem;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            min-height: 100vh;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        h1 {
            color: #2d3748;
            margin-bottom: 1rem;
            font-size: 2rem;
        }

        .test-info {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            margin-bottom: 2rem;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .test-info h2 {
            color: #38b2ac;
            margin-bottom: 0.5rem;
            font-size: 1.25rem;
        }

        .test-info p {
            color: #4a5568;
            line-height: 1.6;
        }

        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 1.5rem;
            margin-bottom: 2rem;
        }

        .test-container {
            background: white;
            padding: 1.5rem;
            border-radius: 8px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.1);
        }

        .test-container h3 {
            color: #2d3748;
            margin-bottom: 1rem;
            font-size: 1.1rem;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }

        .sortable-list {
            list-style: none;
            padding: 0.75rem;
            background: #f7fafc;
            border-radius: 6px;
            border: 2px solid #e2e8f0;
            min-height: 150px;
        }

        .sortable-item {
            padding: 0.75rem 1rem;
            margin-bottom: 0.5rem;
            background: linear-gradient(135deg, #a8edea 0%, #fed6e3 100%);
            color: #2d3748;
            border-radius: 6px;
            cursor: move;
            transition: all 0.2s;
            display: flex;
            align-items: center;
            gap: 0.75rem;
            font-weight: 600;
            user-select: none;
        }

        .sortable-item:last-child {
            margin-bottom: 0;
        }

        .sortable-item:hover {
            transform: translateX(2px);
            box-shadow: 0 2px 4px rgba(56, 178, 172, 0.3);
        }

        .sortable-item.dragging {
            opacity: 0.5;
            transform: scale(1.02);
            box-shadow: 0 4px 8px rgba(56, 178, 172, 0.4);
        }

        .item-icon {
            font-size: 1.25rem;
        }

        .status-badge {
            margin-top: 0.75rem;
            padding: 0.5rem;
            border-radius: 6px;
            font-size: 0.875rem;
            text-align: center;
            font-weight: 600;
        }

        .status-idle {
            background: #edf2f7;
            color: #718096;
        }

        .status-testing {
            background: #bee3f8;
            color: #2c5282;
        }

        .status-pass {
            background: #c6f6d5;
            color: #2f855a;
        }

        .status-fail {
            background: #fed7d7;
            color: #c53030;
        }

        #console {
            background: #1a202c;
            color: #a0aec0;
            padding: 1.5rem;
            border-radius: 8px;
            font-family: 'Courier New', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            max-height: 400px;
            overflow-y: auto;
            box-shadow: inset 0 2px 4px rgba(0, 0, 0, 0.2);
        }

        .console-line {
            margin-bottom: 0.5rem;
        }

        .console-success {
            color: #48bb78;
        }

        .console-error {
            color: #f56565;
        }

        .console-info {
            color: #4299e1;
        }

        .console-time {
            color: #718096;
            margin-right: 0.5rem;
        }

        .note {
            background: #fef5e7;
            border-left: 4px solid #f39c12;
            padding: 0.75rem;
            margin-top: 0.75rem;
            border-radius: 4px;
            font-size: 0.875rem;
            color: #7d5a0c;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üß™ Phase 3: Edge Case Validation</h1>

        <div class="test-info">
            <h2>What We're Testing</h2>
            <p>
                This test validates that the sortable behavior handles edge cases and boundary
                conditions correctly. Each test case is isolated to verify specific scenarios.
            </p>
        </div>

        <script type="text/hyperscript">
behavior Sortable()
  on pointerdown(clientX, clientY)
    set draggedItem to event.target.closest('.sortable-item')
    if no draggedItem exit

    halt the event
    add .dragging to draggedItem

    repeat until event pointerup from document
      wait for pointermove(clientY) or pointerup from document

      set items to <.sortable-item/> in me
      set targetItem to null

      repeat for item in items
        if item is not draggedItem
          measure item's top
          set itemTop to it
          measure item's height
          set itemHeight to it
          set itemMid to itemTop + (itemHeight / 2)

          if clientY < itemMid
            set targetItem to item
            exit
          end
        end
      end

      if targetItem
        call me.insertBefore(draggedItem, targetItem)
      else
        call me.appendChild(draggedItem)
      end
    end

    remove .dragging from draggedItem
  end
end
        </script>

        <div class="test-grid">
            <!-- Edge Case 1: Empty List -->
            <div class="test-container">
                <h3><span>üì≠</span> Empty List</h3>
                <ul class="sortable-list" _="install Sortable()">
                    <!-- Intentionally empty -->
                </ul>
                <div class="status-badge status-pass">‚úÖ No errors expected</div>
                <div class="note">
                    <strong>Test:</strong> Click on empty list should not cause errors.
                </div>
            </div>

            <!-- Edge Case 2: Single Item -->
            <div class="test-container">
                <h3><span>1Ô∏è‚É£</span> Single Item</h3>
                <ul class="sortable-list" _="install Sortable()">
                    <li class="sortable-item">
                        <span class="item-icon">‚≠ê</span>
                        <span>Only Item</span>
                    </li>
                </ul>
                <div class="status-badge status-pass">‚úÖ Should remain in place</div>
                <div class="note">
                    <strong>Test:</strong> Dragging single item should work without errors.
                </div>
            </div>

            <!-- Edge Case 3: Two Items -->
            <div class="test-container">
                <h3><span>2Ô∏è‚É£</span> Two Items</h3>
                <ul class="sortable-list" _="install Sortable()">
                    <li class="sortable-item">
                        <span class="item-icon">ü•á</span>
                        <span>First</span>
                    </li>
                    <li class="sortable-item">
                        <span class="item-icon">ü•à</span>
                        <span>Second</span>
                    </li>
                </ul>
                <div class="status-badge status-idle">Try swapping items</div>
                <div class="note">
                    <strong>Test:</strong> Swap first and second items.
                </div>
            </div>

            <!-- Edge Case 4: Drag First Item Down -->
            <div class="test-container">
                <h3><span>‚¨áÔ∏è</span> First ‚Üí Last</h3>
                <ul class="sortable-list" _="install Sortable()">
                    <li class="sortable-item">
                        <span class="item-icon">üî¥</span>
                        <span>Drag me down</span>
                    </li>
                    <li class="sortable-item">
                        <span class="item-icon">üü°</span>
                        <span>Item 2</span>
                    </li>
                    <li class="sortable-item">
                        <span class="item-icon">üü¢</span>
                        <span>Item 3</span>
                    </li>
                </ul>
                <div class="status-badge status-idle">Drag üî¥ to bottom</div>
                <div class="note">
                    <strong>Test:</strong> First item should move to last position.
                </div>
            </div>

            <!-- Edge Case 5: Drag Last Item Up -->
            <div class="test-container">
                <h3><span>‚¨ÜÔ∏è</span> Last ‚Üí First</h3>
                <ul class="sortable-list" _="install Sortable()">
                    <li class="sortable-item">
                        <span class="item-icon">üü°</span>
                        <span>Item 1</span>
                    </li>
                    <li class="sortable-item">
                        <span class="item-icon">üü¢</span>
                        <span>Item 2</span>
                    </li>
                    <li class="sortable-item">
                        <span class="item-icon">üîµ</span>
                        <span>Drag me up</span>
                    </li>
                </ul>
                <div class="status-badge status-idle">Drag üîµ to top</div>
                <div class="note">
                    <strong>Test:</strong> Last item should move to first position.
                </div>
            </div>

            <!-- Edge Case 6: Rapid Dragging -->
            <div class="test-container">
                <h3><span>‚ö°</span> Rapid Movement</h3>
                <ul class="sortable-list" _="install Sortable()">
                    <li class="sortable-item">
                        <span class="item-icon">1Ô∏è‚É£</span>
                        <span>One</span>
                    </li>
                    <li class="sortable-item">
                        <span class="item-icon">2Ô∏è‚É£</span>
                        <span>Two</span>
                    </li>
                    <li class="sortable-item">
                        <span class="item-icon">3Ô∏è‚É£</span>
                        <span>Three</span>
                    </li>
                    <li class="sortable-item">
                        <span class="item-icon">4Ô∏è‚É£</span>
                        <span>Four</span>
                    </li>
                </ul>
                <div class="status-badge status-idle">Drag rapidly back/forth</div>
                <div class="note">
                    <strong>Test:</strong> Quick up/down dragging should work smoothly.
                </div>
            </div>

            <!-- Edge Case 7: No Movement -->
            <div class="test-container">
                <h3><span>üö´</span> No Movement</h3>
                <ul class="sortable-list" _="install Sortable()">
                    <li class="sortable-item">
                        <span class="item-icon">üéØ</span>
                        <span>Click me</span>
                    </li>
                    <li class="sortable-item">
                        <span class="item-icon">üìå</span>
                        <span>Item 2</span>
                    </li>
                </ul>
                <div class="status-badge status-idle">Click without dragging</div>
                <div class="note">
                    <strong>Test:</strong> Click and release without moving should not reorder.
                </div>
            </div>

            <!-- Edge Case 8: Many Items -->
            <div class="test-container">
                <h3><span>üìö</span> Many Items</h3>
                <ul class="sortable-list" _="install Sortable()" style="max-height: 200px; overflow-y: auto;">
                    <li class="sortable-item">
                        <span class="item-icon">1Ô∏è‚É£</span>
                        <span>Item 1</span>
                    </li>
                    <li class="sortable-item">
                        <span class="item-icon">2Ô∏è‚É£</span>
                        <span>Item 2</span>
                    </li>
                    <li class="sortable-item">
                        <span class="item-icon">3Ô∏è‚É£</span>
                        <span>Item 3</span>
                    </li>
                    <li class="sortable-item">
                        <span class="item-icon">4Ô∏è‚É£</span>
                        <span>Item 4</span>
                    </li>
                    <li class="sortable-item">
                        <span class="item-icon">5Ô∏è‚É£</span>
                        <span>Item 5</span>
                    </li>
                    <li class="sortable-item">
                        <span class="item-icon">6Ô∏è‚É£</span>
                        <span>Item 6</span>
                    </li>
                    <li class="sortable-item">
                        <span class="item-icon">7Ô∏è‚É£</span>
                        <span>Item 7</span>
                    </li>
                    <li class="sortable-item">
                        <span class="item-icon">8Ô∏è‚É£</span>
                        <span>Item 8</span>
                    </li>
                </ul>
                <div class="status-badge status-idle">Try scrolling drag</div>
                <div class="note">
                    <strong>Test:</strong> Performance with many items in scrollable container.
                </div>
            </div>
        </div>

        <div class="test-container" style="margin-bottom: 2rem;">
            <h2 style="margin-bottom: 1rem; color: #2d3748;">üñ•Ô∏è Console Output</h2>
            <div id="console">
                <div class="console-line console-info">
                    üí° All edge cases are isolated in separate containers
                </div>
                <div class="console-line console-info">
                    üß™ Try each test case to verify correct behavior
                </div>
                <div class="console-line console-info">
                    ‚úÖ No errors should appear during any of these tests
                </div>
            </div>
        </div>
    </div>

    <!-- Load HyperFixi -->
    <script src="dist/hyperfixi-browser.js"></script>

    <script>
        // Console logging capture for display
        const consoleDiv = document.getElementById('console');
        const originalLog = console.log;
        const originalError = console.error;

        function addConsoleMessage(type, ...args) {
            const time = new Date().toLocaleTimeString();
            const line = document.createElement('div');
            line.className = `console-line console-${type}`;

            const timeSpan = document.createElement('span');
            timeSpan.className = 'console-time';
            timeSpan.textContent = `[${time}]`;
            line.appendChild(timeSpan);

            const message = args.map(arg => {
                if (typeof arg === 'object') {
                    try {
                        return JSON.stringify(arg, null, 2);
                    } catch (e) {
                        return String(arg);
                    }
                }
                return String(arg);
            }).join(' ');

            line.appendChild(document.createTextNode(message));
            consoleDiv.appendChild(line);
            consoleDiv.scrollTop = consoleDiv.scrollHeight;
        }

        console.log = function(...args) {
            originalLog.apply(console, args);
            addConsoleMessage('info', ...args);
        };

        console.error = function(...args) {
            originalError.apply(console, args);
            addConsoleMessage('error', '‚ùå ERROR:', ...args);
        };

        // Catch uncaught errors
        window.addEventListener('error', (e) => {
            console.error('Uncaught error:', e.message);
        });

        // Log HyperFixi initialization
        console.log('üöÄ HyperFixi loaded and ready');
        console.log('üìç Test page: test-sortable-edges.html');
        console.log('üéØ Testing: Edge cases and boundary conditions');
    </script>
</body>
</html>
