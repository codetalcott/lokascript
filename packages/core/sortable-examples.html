<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>LokaScript - Sortable List Examples</title>

    <!-- Test Navigation -->
    <script src="test-nav.js"></script>

    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 20px;
            background: #f5f5f5;
        }

        /* Debug Toggle Button */
        #debug-toggle {
            position: fixed;
            top: 20px;
            right: 20px;
            padding: 12px 20px;
            background: #333;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 14px;
            font-weight: 600;
            z-index: 1000;
            box-shadow: 0 4px 8px rgba(0,0,0,0.3);
            transition: all 0.2s ease;
        }

        #debug-toggle:hover {
            background: #007bff;
            transform: translateY(-2px);
            box-shadow: 0 6px 12px rgba(0,0,0,0.4);
        }

        #debug-toggle:active {
            transform: translateY(0);
        }

        #debug-toggle.enabled {
            background: #28a745;
        }

        .demo-section {
            background: white;
            margin: 20px 0;
            padding: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 6px rgba(0,0,0,0.1);
        }

        h1 {
            color: #333;
            border-bottom: 3px solid #007bff;
            padding-bottom: 10px;
        }

        h2 {
            color: #555;
            margin-top: 0;
        }

        .description {
            background: #f8f9fa;
            padding: 15px;
            border-left: 4px solid #007bff;
            margin: 15px 0;
            border-radius: 4px;
        }

        .code-block {
            background: #282c34;
            color: #abb2bf;
            padding: 20px;
            border-radius: 8px;
            overflow-x: auto;
            font-family: 'Courier New', monospace;
            font-size: 14px;
            line-height: 1.6;
            margin: 15px 0;
        }

        .code-block .keyword {
            color: #c678dd;
        }

        .code-block .string {
            color: #98c379;
        }

        .code-block .comment {
            color: #5c6370;
            font-style: italic;
        }

        /* Sortable List Styles */
        .sortable-list {
            list-style: none;
            padding: 0;
            margin: 0;
            min-height: 50px;
        }

        .sortable-item {
            padding: 15px 20px;
            margin: 8px 0;
            background: white;
            border: 2px solid #e0e0e0;
            border-radius: 8px;
            cursor: move;
            user-select: none;
            transition: all 0.2s ease;
            display: flex;
            align-items: center;
            gap: 12px;
        }

        .sortable-item:hover {
            border-color: #667eea;
            box-shadow: 0 2px 8px rgba(102, 126, 234, 0.2);
        }

        .sortable-item.dragging {
            opacity: 0.5;
            border-color: #667eea;
            box-shadow: 0 8px 24px rgba(102, 126, 234, 0.4);
            transform: scale(1.02);
            background: #f0f4ff;
        }

        .sortable-item.drag-over {
            border-color: #28a745;
            border-style: dashed;
            background: #e8f5e9;
        }

        .drag-handle {
            font-size: 20px;
            cursor: grab;
            color: #999;
        }

        .drag-handle:active {
            cursor: grabbing;
        }

        /* Priority List Styles */
        .priority-list .sortable-item {
            border-left-width: 6px;
        }

        .priority-list .sortable-item[data-priority="high"] {
            border-left-color: #dc3545;
            background: linear-gradient(90deg, #fff5f5 0%, white 40px);
        }

        .priority-list .sortable-item[data-priority="medium"] {
            border-left-color: #ffc107;
            background: linear-gradient(90deg, #fffbf0 0%, white 40px);
        }

        .priority-list .sortable-item[data-priority="low"] {
            border-left-color: #28a745;
            background: linear-gradient(90deg, #f0fff4 0%, white 40px);
        }

        .priority-badge {
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: bold;
            text-transform: uppercase;
        }

        .priority-badge.high {
            background: #dc3545;
            color: white;
        }

        .priority-badge.medium {
            background: #ffc107;
            color: #333;
        }

        .priority-badge.low {
            background: #28a745;
            color: white;
        }

        /* Multi-list Container */
        .multi-list-container {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-top: 20px;
        }

        .list-column {
            background: #f8f9fa;
            padding: 20px;
            border-radius: 8px;
            border: 2px dashed #ddd;
            min-height: 300px;
        }

        .list-column h4 {
            margin: 0 0 15px 0;
            color: #555;
            font-size: 16px;
            text-align: center;
            padding-bottom: 10px;
            border-bottom: 2px solid #ddd;
        }

        .status {
            background: #e3f2fd;
            padding: 10px;
            border-radius: 4px;
            margin: 15px 0;
            font-family: monospace;
            font-size: 13px;
            color: #1976d2;
        }

        .note {
            background: #fff3cd;
            border-left: 4px solid #ffc107;
            padding: 15px;
            margin: 15px 0;
            border-radius: 4px;
        }

        .success-badge {
            display: inline-block;
            background: #28a745;
            color: white;
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 12px;
            font-weight: bold;
            margin-left: 10px;
        }

        /* Event Log */
        .event-log {
            background: #2d2d2d;
            color: #0f0;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            padding: 15px;
            border-radius: 8px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
        }

        .event-log-entry {
            margin: 4px 0;
            padding: 4px;
            border-left: 2px solid #0f0;
            padding-left: 8px;
        }

        .event-log-entry.start {
            color: #0ff;
        }

        .event-log-entry.move {
            color: #ff0;
        }

        .event-log-entry.end {
            color: #0f0;
        }

        .event-log-entry.change {
            color: #f0f;
            font-weight: bold;
        }

        @media (max-width: 768px) {
            .multi-list-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
    <!-- Debug Toggle Button -->
    <button id="debug-toggle" onclick="toggleDebug()">
        üêõ Debug: OFF
    </button>

    <h1>üìë LokaScript - Sortable List Examples</h1>

    <div class="description">
        <strong>Pure Hyperscript Sortable Lists</strong> - These examples demonstrate drag-to-reorder functionality
        using only hyperscript behavior patterns. Perfect for TODO lists, playlists, dashboards, and more.
    </div>

    <!-- Example 1: Simple TODO List -->
    <div class="demo-section">
        <h2>‚úÖ Example 1: Simple TODO List <span class="success-badge">DRAG TO REORDER</span></h2>

        <div class="description">
            <p><strong>Pattern:</strong> Basic vertical list with drag-to-reorder functionality</p>
            <p><strong>Features tested:</strong></p>
            <ul>
                <li><code>behavior Sortable()</code> - Sortable behavior definition</li>
                <li><code>install Sortable()</code> - Behavior installation on list</li>
                <li><code>on pointerdown</code> - Drag initiation</li>
                <li><code>measure</code> - Element position tracking</li>
                <li><code>trigger</code> - Custom events (sortable:start, move, end, change)</li>
                <li>DOM manipulation - Reordering elements dynamically</li>
            </ul>
        </div>

        <div class="code-block">
<span class="comment">-- Usage: &lt;ul _="install Sortable()"&gt;</span>

<span class="keyword">behavior</span> Sortable()
  <span class="keyword">on</span> pointerdown(clientY) <span class="keyword">from</span> .sortable-item <span class="keyword">in</span> me
    <span class="keyword">halt the event</span>
    <span class="keyword">set</span> draggedItem <span class="keyword">to the target</span>
    <span class="keyword">trigger</span> sortable:start
    <span class="keyword">add</span> .dragging <span class="keyword">to</span> draggedItem
    <span class="keyword">measure</span> draggedItem<span class="keyword">'s</span> height
    <span class="keyword">set</span> itemHeight <span class="keyword">to</span> it
    <span class="keyword">repeat until event</span> pointerup <span class="keyword">from</span> document
      <span class="keyword">wait for</span> pointermove(pageY) <span class="keyword">or</span> pointerup <span class="keyword">from</span> document
      <span class="comment">-- Find insertion point and reorder</span>
      <span class="keyword">trigger</span> sortable:move
    <span class="keyword">end</span>
    <span class="keyword">remove</span> .dragging <span class="keyword">from</span> draggedItem
    <span class="keyword">trigger</span> sortable:end
  <span class="keyword">end</span>
<span class="keyword">end</span>
        </div>

        <div class="status">
            üìù Instructions: Drag any item by clicking and moving it up or down. The list will reorder automatically.
        </div>

        <ul id="todo-list" class="sortable-list"
            _="install Sortable()
               on sortable:start add .sorting to me
               on sortable:end remove .sorting from me
               on sortable:change log 'Order changed!'">
            <li class="sortable-item">
                <span class="drag-handle">‚ò∞</span>
                <span>Complete project documentation</span>
            </li>
            <li class="sortable-item">
                <span class="drag-handle">‚ò∞</span>
                <span>Review pull requests</span>
            </li>
            <li class="sortable-item">
                <span class="drag-handle">‚ò∞</span>
                <span>Update dependencies</span>
            </li>
            <li class="sortable-item">
                <span class="drag-handle">‚ò∞</span>
                <span>Write unit tests</span>
            </li>
            <li class="sortable-item">
                <span class="drag-handle">‚ò∞</span>
                <span>Deploy to production</span>
            </li>
        </ul>

        <div class="note">
            üí° <strong>Tip:</strong> Try dragging items to different positions. The list maintains order dynamically!
        </div>
    </div>

    <!-- Example 2: Priority List -->
    <div class="demo-section">
        <h2>üéØ Example 2: Priority Task List <span class="success-badge">COLOR-CODED</span></h2>

        <div class="description">
            <p><strong>Pattern:</strong> Sortable list with visual priority indicators</p>
            <p><strong>Use case:</strong> Task management, sprint planning, bug triage</p>
        </div>

        <div class="status">
            üìù Instructions: Reorder tasks by priority. Colors indicate: <span style="color: #dc3545;">‚óè</span> High,
            <span style="color: #ffc107;">‚óè</span> Medium, <span style="color: #28a745;">‚óè</span> Low
        </div>

        <ul id="priority-list" class="sortable-list priority-list"
            _="install Sortable()">
            <li class="sortable-item" data-priority="high">
                <span class="drag-handle">‚ò∞</span>
                <span class="priority-badge high">High</span>
                <span>Fix critical security vulnerability</span>
            </li>
            <li class="sortable-item" data-priority="high">
                <span class="drag-handle">‚ò∞</span>
                <span class="priority-badge high">High</span>
                <span>Resolve production outage</span>
            </li>
            <li class="sortable-item" data-priority="medium">
                <span class="drag-handle">‚ò∞</span>
                <span class="priority-badge medium">Medium</span>
                <span>Implement new feature request</span>
            </li>
            <li class="sortable-item" data-priority="medium">
                <span class="drag-handle">‚ò∞</span>
                <span class="priority-badge medium">Medium</span>
                <span>Update API documentation</span>
            </li>
            <li class="sortable-item" data-priority="low">
                <span class="drag-handle">‚ò∞</span>
                <span class="priority-badge low">Low</span>
                <span>Refactor legacy code</span>
            </li>
            <li class="sortable-item" data-priority="low">
                <span class="drag-handle">‚ò∞</span>
                <span class="priority-badge low">Low</span>
                <span>Add code comments</span>
            </li>
        </ul>
    </div>

    <!-- Example 3: Multi-List with Event Log -->
    <div class="demo-section">
        <h2>üìã Example 3: Kanban Board (Multi-List) <span class="success-badge">DRAG BETWEEN LISTS</span></h2>

        <div class="description">
            <p><strong>Pattern:</strong> Multiple sortable lists with cross-list dragging</p>
            <p><strong>Use case:</strong> Kanban boards, workflow management, project planning</p>
        </div>

        <div class="status">
            üìù Instructions: Drag items within a list to reorder, or between lists to change status.
            Watch the event log below!
        </div>

        <div class="multi-list-container">
            <div class="list-column">
                <h4>üìù TODO</h4>
                <ul id="todo-column" class="sortable-list"
                    _="install Sortable()
                       on sortable:start call logEvent('Drag started in TODO')
                       on sortable:change call logEvent('TODO list changed')
                       on sortable:end call logEvent('Drag ended')">
                    <li class="sortable-item">
                        <span class="drag-handle">‚ò∞</span>
                        <span>Design new landing page</span>
                    </li>
                    <li class="sortable-item">
                        <span class="drag-handle">‚ò∞</span>
                        <span>Write blog post</span>
                    </li>
                    <li class="sortable-item">
                        <span class="drag-handle">‚ò∞</span>
                        <span>Update pricing page</span>
                    </li>
                </ul>
            </div>

            <div class="list-column">
                <h4>‚úÖ DONE</h4>
                <ul id="done-column" class="sortable-list"
                    _="install Sortable()
                       on sortable:start call logEvent('Drag started in DONE')
                       on sortable:change call logEvent('DONE list changed')
                       on sortable:end call logEvent('Drag ended')">
                    <li class="sortable-item">
                        <span class="drag-handle">‚ò∞</span>
                        <span>Set up CI/CD pipeline</span>
                    </li>
                    <li class="sortable-item">
                        <span class="drag-handle">‚ò∞</span>
                        <span>Configure monitoring</span>
                    </li>
                </ul>
            </div>
        </div>

        <div class="note">
            ‚ö†Ô∏è <strong>Note:</strong> Cross-list dragging requires additional logic to detect drop targets across containers.
            This is a simplified example showing same-list sorting. Full multi-list support would require
            detecting which container the mouse is over during drag.
        </div>

        <div>
            <h3>Event Log</h3>
            <div id="event-log" class="event-log">
                <div class="event-log-entry">Ready. Start dragging to see events...</div>
            </div>
        </div>
    </div>

    <!-- Implementation Status -->
    <div class="demo-section">
        <h2>üìä Implementation Status</h2>

        <div class="description">
            <p><strong>Sortable Behavior Requirements:</strong></p>
            <table style="width: 100%; border-collapse: collapse;">
                <tr style="border-bottom: 2px solid #ddd;">
                    <th style="text-align: left; padding: 10px;">Feature</th>
                    <th style="text-align: left; padding: 10px;">Implementation</th>
                    <th style="text-align: center; padding: 10px;">Status</th>
                </tr>
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 10px;"><code>behavior</code> definition</td>
                    <td style="padding: 10px;">Define Sortable behavior with init</td>
                    <td style="padding: 10px; text-align: center;">‚úÖ Required</td>
                </tr>
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 10px;"><code>on pointerdown</code></td>
                    <td style="padding: 10px;">Capture drag initiation</td>
                    <td style="padding: 10px; text-align: center;">‚úÖ Should Work</td>
                </tr>
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 10px;"><code>measure</code></td>
                    <td style="padding: 10px;">Get element positions/dimensions</td>
                    <td style="padding: 10px; text-align: center;">‚ö†Ô∏è Needs Testing</td>
                </tr>
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 10px;"><code>trigger</code> events</td>
                    <td style="padding: 10px;">Emit sortable:* custom events</td>
                    <td style="padding: 10px; text-align: center;">‚ö†Ô∏è Needs Testing</td>
                </tr>
                <tr style="border-bottom: 1px solid #eee;">
                    <td style="padding: 10px;">DOM manipulation</td>
                    <td style="padding: 10px;">Reorder elements with insertBefore</td>
                    <td style="padding: 10px; text-align: center;">‚ö†Ô∏è Needs Implementation</td>
                </tr>
                <tr>
                    <td style="padding: 10px;">Position calculation</td>
                    <td style="padding: 10px;">Find insertion point from mouse Y</td>
                    <td style="padding: 10px; text-align: center;">‚ö†Ô∏è Needs Implementation</td>
                </tr>
            </table>
        </div>

        <div class="note">
            üí° <strong>Testing Strategy:</strong>
            <ol>
                <li>Open this page at <a href="http://127.0.0.1:3000/sortable-examples.html">http://127.0.0.1:3000/sortable-examples.html</a></li>
                <li>Check browser console for LokaScript loading</li>
                <li>Try dragging items in the TODO list</li>
                <li>Verify visual feedback (dragging class)</li>
                <li>Check if items reorder correctly</li>
                <li>Monitor event log for custom events</li>
            </ol>
        </div>
    </div>

    <!-- Load LokaScript -->
    <script>
        // Cache busting for development - force fresh load
        const script = document.createElement('script');
        script.src = '/dist/hyperfixi.js?v=' + Date.now();
        document.write(script.outerHTML);
    </script>

    <!-- Define Sortable Behavior in Hyperscript -->
    <script type="text/hyperscript">
behavior Sortable()
  on pointerdown(clientY)
    halt the event
    set draggedItem to event.target.closest('.sortable-item')
    if no draggedItem exit
    trigger sortable:start
    add .dragging to draggedItem
    measure draggedItem's top
    set startTop to it
    set initialHTML to my innerHTML
    repeat until event pointerup from document
      wait for pointermove(clientY) or pointerup from document
      set currentY to clientY
      set items to <.sortable-item/> in me
      set targetItem to null
      repeat for item in items
        if item is not draggedItem
          measure item's top
          set itemTop to it
          measure item's height
          set itemHeight to it
          set itemMid to itemTop + (itemHeight / 2)
          if currentY < itemMid
            set targetItem to item
            exit
          end
        end
      end
      if targetItem
        call me.insertBefore(draggedItem, targetItem)
      else
        call me.appendChild(draggedItem)
      end
      trigger sortable:move
    end
    remove .dragging from draggedItem
    trigger sortable:end
    if my innerHTML is not initialHTML
      trigger sortable:change
    end
  end
end
    </script>

    <script>
        // Pure JavaScript for debug toggle and event logging
        window.addEventListener('load', () => {
            console.log('üöÄ LokaScript Sortable Examples Page Loaded');
            console.log('üìä LokaScript Available:', typeof hyperfixi !== 'undefined');

            if (typeof hyperfixi !== 'undefined') {
                console.log('‚úÖ LokaScript Methods:', Object.keys(hyperfixi));
            } else {
                console.error('‚ùå LokaScript not loaded! Check /dist/hyperfixi.js');
            }
        });

        // Initialize debug button state
        function initDebugButton() {
            const isEnabled = window.__HYPERFIXI_DEBUG__ === true;
            const button = document.getElementById('debug-toggle');
            if (isEnabled) {
                button.textContent = 'üêõ Debug: ON';
                button.classList.add('enabled');
            } else {
                button.textContent = 'üêõ Debug: OFF';
                button.classList.remove('enabled');
            }
        }

        // Toggle debug mode
        function toggleDebug() {
            const currentState = window.__HYPERFIXI_DEBUG__ === true;
            const newState = !currentState;

            if (newState) {
                localStorage.setItem('__HYPERFIXI_DEBUG__', 'true');
                window.__HYPERFIXI_DEBUG__ = true;
            } else {
                localStorage.removeItem('__HYPERFIXI_DEBUG__');
                window.__HYPERFIXI_DEBUG__ = false;
            }

            location.reload();
        }

        // Check localStorage on page load
        if (localStorage.getItem('__HYPERFIXI_DEBUG__') === 'true') {
            window.__HYPERFIXI_DEBUG__ = true;
        }

        // Initialize button state when page loads
        window.addEventListener('DOMContentLoaded', initDebugButton);

        // Event logging function
        window.logEvent = function(message) {
            const logDiv = document.getElementById('event-log');
            if (logDiv) {
                const entry = document.createElement('div');
                entry.className = 'event-log-entry';

                // Determine event type for styling
                if (message.includes('started')) {
                    entry.classList.add('start');
                } else if (message.includes('changed')) {
                    entry.classList.add('change');
                } else if (message.includes('ended')) {
                    entry.classList.add('end');
                } else {
                    entry.classList.add('move');
                }

                const timestamp = new Date().toLocaleTimeString();
                entry.textContent = `[${timestamp}] ${message}`;

                logDiv.appendChild(entry);

                // Auto-scroll to bottom
                logDiv.scrollTop = logDiv.scrollHeight;

                // Keep only last 50 entries
                while (logDiv.children.length > 50) {
                    logDiv.removeChild(logDiv.firstChild);
                }
            }
        };

        // Log sortable events to console
        document.addEventListener('sortable:start', (e) => {
            console.log('üéØ Sortable drag started:', e.target);
        });

        document.addEventListener('sortable:move', (e) => {
            console.log('üîÑ Sortable item moved:', e.target);
        });

        document.addEventListener('sortable:end', (e) => {
            console.log('‚úÖ Sortable drag ended:', e.target);
        });

        document.addEventListener('sortable:change', (e) => {
            console.log('‚ö° Sortable order changed:', e.target);
        });
    </script>
</body>
</html>
