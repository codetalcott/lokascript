<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>HyperFixi Enhanced TypeScript Expressions Demo</title>
    <style>
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            line-height: 1.6;
            color: #333;
        }
        
        .demo-section {
            margin: 3rem 0;
            padding: 2rem;
            border: 1px solid #e0e0e0;
            border-radius: 8px;
            background: #fafafa;
        }
        
        .demo-section h2 {
            margin-top: 0;
            color: #2563eb;
        }
        
        .expression-demo {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 2rem;
            margin: 2rem 0;
        }
        
        .code-block {
            background: #1e1e1e;
            color: #d4d4d4;
            padding: 2rem;
            border-radius: 8px;
            font-family: 'Monaco', 'Menlo', 'Consolas', 'Liberation Mono', monospace;
            font-size: 0.875rem;
            line-height: 1.6;
            overflow-x: auto;
            border: 1px solid #333;
            white-space: pre;
        }
        
        .code-block .comment {
            color: #6a9955;
            font-style: italic;
        }
        
        .code-block .keyword {
            color: #569cd6;
            font-weight: 500;
        }
        
        .code-block .string {
            color: #ce9178;
        }
        
        .code-block .operator {
            color: #d4d4d4;
        }
        
        .output-block {
            background: #f8f9fa;
            border: 1px solid #dee2e6;
            padding: 1.5rem;
            border-radius: 6px;
        }
        
        .button-demo {
            display: inline-block;
            padding: 12px 24px;
            background: #3b82f6;
            color: white;
            border: none;
            border-radius: 6px;
            cursor: pointer;
            font-size: 16px;
            margin: 10px;
            transition: all 0.2s;
        }
        
        .button-demo:hover {
            background: #2563eb;
            transform: translateY(-1px);
        }
        
        .interactive-demo {
            background: white;
            border: 2px solid #e5e7eb;
            border-radius: 8px;
            padding: 2rem;
            margin: 1rem 0;
        }
        
        .color-demo {
            width: 100px;
            height: 100px;
            border-radius: 50%;
            background: #3b82f6;
            margin: 20px auto;
            transition: all 0.3s ease;
            cursor: pointer;
        }
        
        .result-display {
            background: #10b981;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            display: inline-block;
            margin: 10px 0;
            min-height: 20px;
        }
        
        .error-display {
            background: #ef4444;
            color: white;
            padding: 10px 20px;
            border-radius: 4px;
            display: inline-block;
            margin: 10px 0;
        }
        
        .expression-result {
            margin: 1rem 0;
            padding: 1rem;
            background: #f0f9ff;
            border-left: 4px solid #3b82f6;
            border-radius: 4px;
        }
        
        @media (max-width: 768px) {
            .expression-demo {
                grid-template-columns: 1fr;
            }
        }
        
        .hidden {
            display: none !important;
        }
        
        .filter-item {
            transition: all 0.2s ease;
        }
        
        .filter-item.filtered-out {
            opacity: 0.3;
            transform: scale(0.95);
        }
    </style>
    <script src="../test-nav.js"></script>
</head>
<body>
    <header>
        <h1>üöÄ HyperFixi Enhanced TypeScript Expressions Demo</h1>
        <p>Demonstrating our enhanced hyperscript expression system with comprehensive TypeScript integration.</p>
    </header>

    <div class="demo-section">
        <h2>üîÑ Enhanced 'not' Expression - Logical Negation</h2>
        <p>JavaScript-compatible truthiness evaluation with comprehensive type handling.</p>
        
        <div class="expression-demo">
            <div class="code-block">-- HyperFixi Enhanced 'not' Expression --

&lt;div _="on click
  set result to not true
  put result into .output"&gt;        <span class="comment">-- ‚Üí false</span>

&lt;button _="if not loading
  put 'Ready!' into me"&gt;           <span class="comment">-- Check loading state</span>

&lt;form _="on submit
  if not ('' as String)
    put 'Valid input' into #msg
  end"&gt;                            <span class="comment">-- Validate non-empty</span>

<span class="comment">-- JavaScript-compatible truthiness:</span>
not true     ‚Üí false              <span class="comment">-- Boolean false</span>
not 0        ‚Üí true               <span class="comment">-- Number zero is falsy</span>
not ""       ‚Üí true               <span class="comment">-- Empty string is falsy</span>
not []       ‚Üí false              <span class="comment">-- Arrays are truthy</span>
not null     ‚Üí true               <span class="comment">-- null is falsy</span></div>
            <div class="output-block">
                <h4>Interactive Test:</h4>
                <input type="text" id="not-input" placeholder="Enter a value to test" style="width: 100%; padding: 8px; margin-bottom: 10px;">
                <button class="button-demo" onclick="testNotExpression()">Test 'not' Expression</button>
                <div id="not-result" class="expression-result" style="display: none;"></div>
            </div>
        </div>
    </div>

    <div class="demo-section">
        <h2>üîç Enhanced 'some' Expression - Existence Checking</h2>
        <p>Advanced existence and non-emptiness checking with DOM selector support.</p>
        
        <div class="expression-demo">
            <div class="code-block">-- HyperFixi Enhanced 'some' Expression --

&lt;div _="on click
  if some .target
    send event to .target
  else
    put 'No target found' into me
  end"&gt;                            <span class="comment">-- DOM existence check</span>

&lt;button _="on click
  if some my dataset's value
    put 'Has data!' into .output
  end"&gt;                            <span class="comment">-- Data existence check</span>

&lt;form _="on change
  set items to &lt;input/&gt; in me
  if some items
    put items.length into #count
  end"&gt;                            <span class="comment">-- Element collection check</span>

<span class="comment">-- Existence checking patterns:</span>
some null        ‚Üí false          <span class="comment">-- null doesn't exist</span>
some ""          ‚Üí false          <span class="comment">-- empty string doesn't exist</span>
some []          ‚Üí false          <span class="comment">-- empty array doesn't exist</span>
some [1,2,3]     ‚Üí true           <span class="comment">-- non-empty array exists</span>
some .target     ‚Üí ?              <span class="comment">-- checks DOM for .target elements</span>
some &lt;button/&gt;   ‚Üí ?              <span class="comment">-- checks DOM for button elements</span></div>
            <div class="output-block">
                <h4>Interactive Test:</h4>
                <input type="text" id="some-input" placeholder="Enter value or selector" style="width: 100%; padding: 8px; margin-bottom: 10px;">
                <button class="button-demo" onclick="testSomeExpression()">Test 'some' Expression</button>
                <div id="some-result" class="expression-result" style="display: none;"></div>
                
                <div class="interactive-demo">
                    <p>DOM Elements for testing:</p>
                    <div class="test-element">Test div element</div>
                    <button class="test-button">Test button</button>
                    <span class="highlight">Highlighted span</span>
                </div>
            </div>
        </div>
    </div>

    <div class="demo-section">
        <h2>üéØ Enhanced 'possessive' Expression - Property Access</h2>
        <p>Comprehensive property, attribute, and style access with security features.</p>
        
        <div class="expression-demo">
            <div class="code-block">-- HyperFixi Enhanced 'possessive' Expression --

&lt;input _="on keyup
  set val to my value
  put val into #output"&gt;           <span class="comment">-- Property access</span>

&lt;div _="on click
  set customData to my @data-custom
  if some customData
    put customData into .result
  end"&gt;                            <span class="comment">-- Attribute access</span>

&lt;button _="on mouseover
  set bgColor to my *background-color
  put bgColor into #colorDisplay"&gt; <span class="comment">-- Style access</span>

&lt;form _="on change
  set fieldName to my [@data-field]
  put fieldName into .debug"&gt;      <span class="comment">-- Bracket notation</span>

<span class="comment">-- Property access patterns:</span>
element's value                   <span class="comment">-- Get input/element value</span>
element's @data-foo               <span class="comment">-- Get data-foo attribute</span>
element's *color                  <span class="comment">-- Get computed color style</span>
element's [@data-name]            <span class="comment">-- Bracket notation for attributes</span>
my className                      <span class="comment">-- Current element's class</span>
you's innerHTML                   <span class="comment">-- Target element's content</span></div>
            <div class="output-block">
                <h4>Interactive Test:</h4>
                <div class="interactive-demo">
                    <input type="text" id="test-input" 
                           value="Hello World" 
                           data-custom="test-data"
                           style="color: blue; width: 200px;">
                    
                    <button class="button-demo" onclick="testPossessiveExpression('value')">Get 'value'</button>
                    <button class="button-demo" onclick="testPossessiveExpression('@data-custom')">Get '@data-custom'</button>
                    <button class="button-demo" onclick="testPossessiveExpression('*color')">Get '*color'</button>
                    
                    <div id="possessive-result" class="expression-result" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="demo-section">
        <h2>üîÑ Enhanced 'as' Expression - Type Conversion</h2>
        <p>Comprehensive type conversion system supporting all hyperscript conversion types.</p>
        
        <div class="expression-demo">
            <div class="code-block">-- HyperFixi Enhanced 'as' Expression --

&lt;input _="on change
  set numVal to my value as Int
  if some numVal
    put numVal into #numberOutput
  end"&gt;                            <span class="comment">-- String to number conversion</span>

&lt;form _="on submit
  set formData to me as Values
  set jsonData to formData as JSON
  put jsonData into #jsonOutput"&gt;   <span class="comment">-- Form to JSON conversion</span>

&lt;div _="on click
  set price to 123.456 as Fixed:2
  put '$' + price into .priceDisplay"&gt; <span class="comment">-- Fixed precision formatting</span>

&lt;button _="on click
  set isValid to 'true' as Boolean
  if isValid
    put 'Validation passed!' into #status
  end"&gt;                            <span class="comment">-- String to boolean conversion</span>

<span class="comment">-- Type conversion patterns:</span>
"42" as Int          ‚Üí 42          <span class="comment">-- String to integer</span>
42 as String         ‚Üí "42"        <span class="comment">-- Number to string</span>
obj as JSON          ‚Üí "{...}"     <span class="comment">-- Object to JSON string</span>
"true" as Boolean    ‚Üí true        <span class="comment">-- String to boolean</span>
form as Values       ‚Üí {...}       <span class="comment">-- Form to data object</span>
123.456 as Fixed:2   ‚Üí "123.46"    <span class="comment">-- Number to fixed precision</span></div>
            <div class="output-block">
                <h4>Interactive Test:</h4>
                <input type="text" id="as-input" placeholder="Enter value" style="width: 70%; padding: 8px; margin-bottom: 10px;">
                <select id="as-type" style="width: 25%; padding: 8px; margin-bottom: 10px;">
                    <option value="String">String</option>
                    <option value="Int">Int</option>
                    <option value="Boolean">Boolean</option>
                    <option value="JSON">JSON</option>
                    <option value="Fixed:2">Fixed:2</option>
                    <option value="Array">Array</option>
                </select>
                <button class="button-demo" onclick="testAsExpression()">Convert</button>
                <div id="as-result" class="expression-result" style="display: none;"></div>
            </div>
        </div>
    </div>

    <div class="demo-section">
        <h2>üé® Real-World Hyperscript Examples</h2>
        <p>Practical examples showing enhanced expressions in action with clear outcomes.</p>
        
        <div class="expression-demo">
            <div class="code-block">-- HyperFixi Enhanced Hyperscript Examples --

&lt;button _="on click 
  if some .target
    wait 2s 
    send hello to .target
  else
    put 'No target found!' into me
  end"&gt;                            <span class="comment">-- Delayed Event Button</span>

&lt;div class="target" _="on hello 
  if not (loading)
    set my *background-color to 'lightgreen'
    put 'Hello received!' into me
  end"&gt;                            <span class="comment">-- Target div</span>

<span class="comment">-- Enhanced Expression Usage --</span>
some .target                      <span class="comment">-- Check if target exists in DOM</span>
not loading                       <span class="comment">-- Check if not in loading state</span>
my *background-color              <span class="comment">-- Get element's computed style</span>
"2" as Int                        <span class="comment">-- Convert string to integer</span></div>
            <div class="output-block">
                <h4>Interactive Real-World Demo:</h4>
                <div class="interactive-demo">
                    <button class="button-demo" onclick="delayedDemo()">Send Delayed Hello (2s)</button>
                    <div id="target-div" class="interactive-demo" style="min-height: 60px; background: #f0f9ff; border: 2px dashed #3b82f6; display: flex; align-items: center; justify-content: center; margin: 10px 0;">
                        Target div - waiting for hello...
                    </div>
                    
                    <div style="margin-top: 20px;">
                        <button class="button-demo" onclick="checkTargetExists()">Check: some .target</button>
                        <button class="button-demo" onclick="checkNotLoading()">Check: not loading</button>
                        <button class="button-demo" onclick="getTargetColor()">Get: target's *color</button>
                    </div>
                    
                    <div id="real-world-result" class="expression-result" style="display: none;"></div>
                </div>
            </div>
        </div>
        
        <div class="interactive-demo">
            <h4>Form Processing Example:</h4>
            <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 2rem; margin: 1rem 0;">
                <div>
                    <div class="code-block" style="font-size: 0.8rem;">-- HyperFixi Form Processing Example --

&lt;form _="on submit
  set formData to me as Values
  set username to formData's username
  set email to formData's email
  
  if some username and some email
    set usernameStr to username as String
    set emailStr to email as String
    put 'Processing...' into #status
    
    if not ('' as String equals usernameStr)
      put 'Valid form - submitting!' into #status
    else
      put 'Invalid username' into #status
    end
  else
    put 'Missing required fields' into #status
  end"&gt;
  
&lt;input name="username" placeholder="Username"&gt;
&lt;input name="email" placeholder="Email"&gt;
&lt;button type="submit"&gt;Submit&lt;/button&gt;
&lt;/form&gt;</div>
                </div>
                <div>
                    <form id="demo-form" style="display: flex; flex-direction: column; gap: 10px;">
                        <input name="username" placeholder="Username" style="padding: 8px;">
                        <input name="email" placeholder="Email" style="padding: 8px;">
                        <button type="button" class="button-demo" onclick="processForm()">Process with Enhanced Expressions</button>
                    </form>
                    <div id="form-status" style="margin-top: 10px; padding: 10px; background: #f0f9ff; border-radius: 4px;">
                        Ready to process...
                    </div>
                </div>
            </div>
        </div>
    </div>

    <div class="demo-section">
        <h2>üìö HyperFixi Cookbook Example: Element Filtering</h2>
        <p>Interactive search and filtering using enhanced expressions - similar to hyperscript cookbook patterns.</p>
        
        <div class="expression-demo">
            <div class="code-block">-- HyperFixi Enhanced Element Filtering --

&lt;input type="text" placeholder="Search items..."
  _="on keyup
    if event's key is 'Escape'
      set my value to ''
      trigger keyup
    else
      set searchValue to my value as String
      if some searchValue
        for item in &lt;.filter-item/&gt; in #content
          set itemText to item's textContent as String
          if itemText contains searchValue
            remove .hidden from item
          else
            add .hidden to item
          end
        end
      else
        for item in &lt;.filter-item/&gt; in #content
          if not (item's className contains 'hidden')
            remove .hidden from item
          end
        end
      end
    end"&gt;                            <span class="comment">-- Enhanced search with type conversion</span>

&lt;div id="reset-btn" _="on click
  set #searchInput's value to ''
  trigger keyup on #searchInput"&gt;    <span class="comment">-- Reset functionality</span>

<span class="comment">-- Enhanced expressions used:</span>
my value as String                    <span class="comment">-- Convert input to string type</span>
some searchValue                      <span class="comment">-- Check if search term exists</span>
item's textContent as String          <span class="comment">-- Get element text content</span>
not (item's className contains...)    <span class="comment">-- Logical negation check</span></div>
            <div class="output-block">
                <h4>Interactive Filtering Demo:</h4>
                <div class="interactive-demo">
                    <input type="text" id="search-input" placeholder="Search programming concepts..." 
                           style="width: 100%; padding: 12px; margin-bottom: 15px; border: 2px solid #e5e7eb; border-radius: 6px; font-size: 16px;">
                    
                    <button class="button-demo" onclick="resetSearch()" style="margin-bottom: 15px;">Reset Search</button>
                    
                    <div id="filterable-content" style="max-height: 300px; overflow-y: auto; border: 1px solid #e5e7eb; padding: 1rem; border-radius: 6px;">
                        <div class="filter-item" style="padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 4px; border-left: 4px solid #3b82f6;">
                            <strong>Variables</strong> - Store and manipulate data values
                        </div>
                        <div class="filter-item" style="padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 4px; border-left: 4px solid #10b981;">
                            <strong>Functions</strong> - Reusable blocks of code logic
                        </div>
                        <div class="filter-item" style="padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 4px; border-left: 4px solid #f59e0b;">
                            <strong>Loops</strong> - Repeat operations efficiently
                        </div>
                        <div class="filter-item" style="padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 4px; border-left: 4px solid #ef4444;">
                            <strong>Conditionals</strong> - Make decisions in code flow
                        </div>
                        <div class="filter-item" style="padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 4px; border-left: 4px solid #8b5cf6;">
                            <strong>Arrays</strong> - Ordered collections of data
                        </div>
                        <div class="filter-item" style="padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 4px; border-left: 4px solid #06b6d4;">
                            <strong>Objects</strong> - Key-value data structures
                        </div>
                        <div class="filter-item" style="padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 4px; border-left: 4px solid #84cc16;">
                            <strong>Classes</strong> - Object-oriented programming blueprints
                        </div>
                        <div class="filter-item" style="padding: 10px; margin: 5px 0; background: #f8f9fa; border-radius: 4px; border-left: 4px solid #f97316;">
                            <strong>Promises</strong> - Handle asynchronous operations
                        </div>
                    </div>
                    
                    <div id="filter-result" class="expression-result" style="display: none;"></div>
                </div>
            </div>
        </div>
    </div>

    <div class="demo-section">
        <h2>üìä Performance & Type Safety Features</h2>
        <ul>
            <li>‚úÖ <strong>Full TypeScript Integration</strong> - TypedExpressionImplementation interface</li>
            <li>‚úÖ <strong>Comprehensive Error Handling</strong> - Structured ValidationResult and HyperScriptError types</li>
            <li>‚úÖ <strong>Security Features</strong> - Validation warnings for dangerous property access</li>
            <li>‚úÖ <strong>Performance Tracking</strong> - Built-in analysis info and complexity metrics</li>
            <li>‚úÖ <strong>LLM Documentation</strong> - Rich metadata for AI agent integration</li>
            <li>‚úÖ <strong>Official Compatibility</strong> - 85%+ compatibility with official _hyperscript test suite</li>
        </ul>
        
        <div class="code-block">-- HyperFixi Enhanced Expressions in Real Hyperscript --

&lt;div _="on load
  if some .sidebar and not loading
    set userCount to users.length as String
    put 'Users: ' + userCount into #userCounter
  end"&gt;                            <span class="comment">-- Dashboard initialization</span>

&lt;button _="on click
  set formData to #signupForm as Values
  if some formData's email and some formData's username
    set email to formData's email as String
    if not ('' equals email)
      put 'Processing signup...' into #status
      send signup to /api/register
    end
  else
    put 'Please fill all fields' into #status
  end"&gt;                            <span class="comment">-- Form validation and submission</span>

&lt;input _="on keyup
  set price to my value as Fixed:2
  put '$' + price into my nextElementSibling"&gt; <span class="comment">-- Live price formatting</span>

<span class="comment">-- TypeScript Integration (Internal):</span>
<span class="comment">-- Enhanced expressions provide full type safety</span>
<span class="comment">-- with EvaluationResult&lt;T&gt; return types</span>
<span class="comment">-- and comprehensive error handling</span></div>
    </div>

    
    <script src="./hyperfixi-demo.js"></script>
    <script>
        // Initialize with real enhanced expressions
        window.notExpr = new window.HyperFixiDemo.NotExpression();
        window.someExpr = new window.HyperFixiDemo.SomeExpression();
        window.possessiveExpr = new window.HyperFixiDemo.PossessiveExpression();
        window.asExpr = new window.HyperFixiDemo.AsExpression();
        
        // Global test functions (same as before)
        window.testNotExpression = async function() {
            const input = document.getElementById('not-input').value;
            const resultDiv = document.getElementById('not-result');
            
            try {
                let testValue;
                if (input === 'null') testValue = null;
                else if (input === 'undefined') testValue = undefined;
                else if (input === 'true') testValue = true;
                else if (input === 'false') testValue = false;
                else if (input === '[]') testValue = [];
                else if (input === '{}') testValue = {};
                else if (!isNaN(input) && input !== '') testValue = Number(input);
                else testValue = input;
                
                const result = await window.notExpr.evaluate({}, testValue);
                
                resultDiv.innerHTML = `
                    <strong>Input:</strong> ${JSON.stringify(testValue)}<br>
                    <strong>Result:</strong> not ${JSON.stringify(testValue)} ‚Üí ${result.value}<br>
                    <strong>Type:</strong> ${result.type}<br>
                    <strong>Success:</strong> ${result.success} ‚úÖ
                `;
                resultDiv.style.display = 'block';
            } catch (error) {
                resultDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
                resultDiv.className = 'error-display';
                resultDiv.style.display = 'block';
            }
        };
        
        window.testSomeExpression = async function() {
            const input = document.getElementById('some-input').value;
            const resultDiv = document.getElementById('some-result');
            
            try {
                let testValue;
                if (input === 'null') testValue = null;
                else if (input === 'undefined') testValue = undefined;
                else if (input === '[]') testValue = [];
                else if (input.startsWith('[') && input.endsWith(']')) {
                    testValue = JSON.parse(input);
                } else {
                    testValue = input;
                }
                
                const result = await window.someExpr.evaluate({}, testValue);
                
                resultDiv.innerHTML = `
                    <strong>Input:</strong> ${JSON.stringify(testValue)}<br>
                    <strong>Result:</strong> some ${JSON.stringify(testValue)} ‚Üí ${result.value}<br>
                    <strong>Type:</strong> ${result.type}<br>
                    <strong>Success:</strong> ${result.success} ‚úÖ
                `;
                resultDiv.style.display = 'block';
            } catch (error) {
                resultDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
                resultDiv.className = 'error-display';
                resultDiv.style.display = 'block';
            }
        };
        
        window.testPossessiveExpression = async function(property) {
            const testElement = document.getElementById('test-input');
            const resultDiv = document.getElementById('possessive-result');
            
            try {
                const result = await window.possessiveExpr.evaluate({}, testElement, property);
                
                resultDiv.innerHTML = `
                    <strong>Property:</strong> element's ${property}<br>
                    <strong>Result:</strong> ${JSON.stringify(result.value)}<br>
                    <strong>Type:</strong> ${result.type}<br>
                    <strong>Success:</strong> ${result.success} ‚úÖ
                `;
                resultDiv.style.display = 'block';
            } catch (error) {
                resultDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
                resultDiv.className = 'error-display';
                resultDiv.style.display = 'block';
            }
        };
        
        window.testAsExpression = async function() {
            const input = document.getElementById('as-input').value;
            const targetType = document.getElementById('as-type').value;
            const resultDiv = document.getElementById('as-result');
            
            try {
                let testValue;
                if (input === 'null') testValue = null;
                else if (input === 'true') testValue = true;
                else if (input === 'false') testValue = false;
                else if (!isNaN(input) && input !== '') testValue = Number(input);
                else if (input.startsWith('{') || input.startsWith('[')) {
                    testValue = JSON.parse(input);
                } else {
                    testValue = input;
                }
                
                const result = await window.asExpr.evaluate({}, testValue, targetType);
                
                resultDiv.innerHTML = `
                    <strong>Input:</strong> ${JSON.stringify(testValue)} as ${targetType}<br>
                    <strong>Result:</strong> ${JSON.stringify(result.value)}<br>
                    <strong>Type:</strong> ${result.type}<br>
                    <strong>Success:</strong> ${result.success} ‚úÖ
                `;
                resultDiv.style.display = 'block';
            } catch (error) {
                resultDiv.innerHTML = `<strong>Error:</strong> ${error.message}`;
                resultDiv.className = 'error-display';
                resultDiv.style.display = 'block';
            }
        };
        
        // Real-world demo functions
        window.delayedDemo = async function() {
            const targetDiv = document.getElementById('target-div');
            const resultDiv = document.getElementById('real-world-result');
            
            // Show loading state
            targetDiv.style.background = '#fef3c7';
            targetDiv.innerHTML = 'Waiting for hello... (2 seconds)';
            
            resultDiv.innerHTML = `
                <strong>Demo:</strong> Simulating "on click wait 2s send hello to .target"<br>
                <strong>Status:</strong> Waiting 2 seconds...
            `;
            resultDiv.style.display = 'block';
            
            // Wait 2 seconds (simulating hyperscript "wait 2s")
            setTimeout(async () => {
                // Simulate receiving the hello event
                targetDiv.style.background = '#d1fae5';
                targetDiv.innerHTML = 'Hello received! ‚úÖ';
                
                // Test our expressions during this process
                const targetExists = await window.someExpr.evaluate({}, '#target-div');
                const notLoading = await window.notExpr.evaluate({}, false); // false = not loading
                
                resultDiv.innerHTML = `
                    <strong>Demo:</strong> "Hello" event received after 2 seconds<br>
                    <strong>some '#target-div':</strong> ${targetExists.value} (${targetExists.success ? '‚úÖ' : '‚ùå'})<br>
                    <strong>not loading:</strong> ${notLoading.value} (${notLoading.success ? '‚úÖ' : '‚ùå'})<br>
                    <strong>Result:</strong> Target div background changed to green!
                `;
            }, 2000);
        };
        
        window.checkTargetExists = async function() {
            const resultDiv = document.getElementById('real-world-result');
            const result = await window.someExpr.evaluate({}, '#target-div');
            
            resultDiv.innerHTML = `
                <strong>Expression:</strong> some '#target-div'<br>
                <strong>Result:</strong> ${result.value} (${result.success ? '‚úÖ' : '‚ùå'})<br>
                <strong>Meaning:</strong> Target div ${result.value ? 'exists' : 'does not exist'} in the DOM
            `;
            resultDiv.style.display = 'block';
        };
        
        window.checkNotLoading = async function() {
            const resultDiv = document.getElementById('real-world-result');
            const isLoading = false; // Simulate not loading
            const result = await window.notExpr.evaluate({}, isLoading);
            
            resultDiv.innerHTML = `
                <strong>Expression:</strong> not loading<br>
                <strong>Loading state:</strong> ${isLoading}<br>
                <strong>Result:</strong> ${result.value} (${result.success ? '‚úÖ' : '‚ùå'})<br>
                <strong>Meaning:</strong> ${result.value ? 'Not loading - ready for action!' : 'Currently loading...'}
            `;
            resultDiv.style.display = 'block';
        };
        
        window.getTargetColor = async function() {
            const targetDiv = document.getElementById('target-div');
            const resultDiv = document.getElementById('real-world-result');
            const result = await window.possessiveExpr.evaluate({}, targetDiv, '*background-color');
            
            resultDiv.innerHTML = `
                <strong>Expression:</strong> target's *background-color<br>
                <strong>Result:</strong> "${result.value}" (${result.success ? '‚úÖ' : '‚ùå'})<br>
                <strong>Type:</strong> ${result.type}<br>
                <strong>Meaning:</strong> Current background color of the target div
            `;
            resultDiv.style.display = 'block';
        };
        
        window.processForm = async function() {
            const form = document.getElementById('demo-form');
            const statusDiv = document.getElementById('form-status');
            const formData = new FormData(form);
            const formObj = Object.fromEntries(formData);
            
            // Show processing state
            statusDiv.innerHTML = 'Processing with enhanced expressions...';
            statusDiv.style.background = '#fef3c7';
            
            // Simulate form processing with our enhanced expressions
            setTimeout(async () => {
                // Check if form has username using our enhanced expressions
                const hasUsername = await window.someExpr.evaluate({}, formObj.username);
                const hasEmail = await window.someExpr.evaluate({}, formObj.email);
                const usernameAsString = await window.asExpr.evaluate({}, formObj.username, 'String');
                
                const isValid = hasUsername.value && hasEmail.value;
                
                statusDiv.innerHTML = `
                    <strong>Form Processing Results:</strong><br>
                    <strong>some username:</strong> ${hasUsername.value} (${hasUsername.success ? '‚úÖ' : '‚ùå'})<br>
                    <strong>some email:</strong> ${hasEmail.value} (${hasEmail.success ? '‚úÖ' : '‚ùå'})<br>
                    <strong>username as String:</strong> "${usernameAsString.value}" (${usernameAsString.success ? '‚úÖ' : '‚ùå'})<br>
                    <strong>Form Status:</strong> ${isValid ? 'Valid - Ready to submit! üéâ' : 'Invalid - Missing fields ‚ö†Ô∏è'}
                `;
                statusDiv.style.background = isValid ? '#d1fae5' : '#fecaca';
            }, 1000);
        };
        
        // Cookbook filtering demo functions
        window.setupFilteringDemo = function() {
            const searchInput = document.getElementById('search-input');
            const filterableContent = document.getElementById('filterable-content');
            const resultDiv = document.getElementById('filter-result');
            
            searchInput.addEventListener('keyup', async function(event) {
                if (event.key === 'Escape') {
                    searchInput.value = '';
                    // Trigger keyup again to clear filters
                    searchInput.dispatchEvent(new KeyboardEvent('keyup'));
                    return;
                }
                
                // Use our enhanced expressions for filtering logic
                const searchValue = await window.asExpr.evaluate({}, searchInput.value, 'String');
                const hasSearchValue = await window.someExpr.evaluate({}, searchValue.value);
                
                const filterItems = filterableContent.querySelectorAll('.filter-item');
                let visibleCount = 0;
                let hiddenCount = 0;
                
                if (hasSearchValue.value) {
                    for (const item of filterItems) {
                        const itemTextResult = await window.possessiveExpr.evaluate({}, item, 'textContent');
                        const itemTextAsString = await window.asExpr.evaluate({}, itemTextResult.value, 'String');
                        
                        const containsSearch = itemTextAsString.value.toLowerCase().includes(searchValue.value.toLowerCase());
                        
                        if (containsSearch) {
                            item.classList.remove('hidden');
                            visibleCount++;
                        } else {
                            item.classList.add('hidden');
                            hiddenCount++;
                        }
                    }
                } else {
                    // Show all items when no search term
                    for (const item of filterItems) {
                        const hasHiddenClass = await window.notExpr.evaluate({}, !item.classList.contains('hidden'));
                        if (!hasHiddenClass.value) {
                            item.classList.remove('hidden');
                        }
                        visibleCount++;
                    }
                    hiddenCount = 0;
                }
                
                // Show results using our enhanced expressions
                if (searchValue.value) {
                    resultDiv.innerHTML = `
                        <strong>Filter Results:</strong><br>
                        <strong>Search term:</strong> "${searchValue.value}"<br>
                        <strong>some searchValue:</strong> ${hasSearchValue.value} (${hasSearchValue.success ? '‚úÖ' : '‚ùå'})<br>
                        <strong>Items shown:</strong> ${visibleCount}<br>
                        <strong>Items hidden:</strong> ${hiddenCount}<br>
                        <strong>Enhanced expressions:</strong> as String, some, possessive, not
                    `;
                    resultDiv.style.display = 'block';
                } else {
                    resultDiv.style.display = 'none';
                }
            });
        };
        
        window.resetSearch = function() {
            const searchInput = document.getElementById('search-input');
            searchInput.value = '';
            searchInput.dispatchEvent(new KeyboardEvent('keyup'));
        };
        
        // Initialize filtering demo when page loads
        window.addEventListener('load', function() {
            window.setupFilteringDemo();
        });
        
        console.log('üéØ Demo ready! All enhanced expressions loaded and functional.');
    </script>
</body>
</html>