<!DOCTYPE html>
<html>
<head>
    <title>Test Parser Fix - "The X of Y" Syntax</title>
    <style>
        body { font-family: monospace; padding: 20px; }
        .log { border: 1px solid #ccc; padding: 10px; margin: 5px 0; background: #f9f9f9; }
        .success { background: #e8f5e9; border-color: #4caf50; }
        .error { background: #ffebee; border-color: #f44336; }
        #test-element { padding: 15px; background: lightblue; margin: 10px 0; }
    </style>
</head>
<body>
    <h1>Parser Fix Test - "The X of Y" Syntax</h1>
    <div id="output"></div>
    <div id="test-element">Test Element - Click buttons to test parsing</div>
    
    <!-- These should NOW work with the parser fix -->
    <button _="on click set the textContent of #test-element to 'SUCCESS: the X of Y works!'">
        Test: set the textContent of #test-element
    </button>
    
    <button _="on click set the innerHTML of #test-element to '<strong>SUCCESS: innerHTML works!</strong>'">
        Test: set the innerHTML of #test-element  
    </button>
    
    <button _="on click set the className of #test-element to 'highlight'">
        Test: set the className of #test-element
    </button>
    
    <!-- Control tests - these should still work -->
    <button _="on click set my textContent to 'Possessive syntax still works'">
        Control: possessive syntax (my)
    </button>
    
    <script src="dist/hyperfixi-browser.js"></script>
    <script>
        const output = document.getElementById('output');
        
        function addLog(type, ...args) {
            const div = document.createElement('div');
            div.className = `log ${type}`;
            div.innerHTML = `<strong>[${type.toUpperCase()}]</strong> ${args.map(arg => 
                typeof arg === 'object' ? JSON.stringify(arg, null, 2) : String(arg)
            ).join(' ')}`;
            output.appendChild(div);
        }
        
        // Capture console logs and errors
        const originalLog = console.log;
        const originalError = console.error;
        
        console.log = function(...args) {
            const message = args.join(' ');
            // Show parsing-related logs
            if (message.includes('PARSER:') || message.includes('ATTR:') || message.includes('parseSetCommand')) {
                addLog('info', ...args);
            }
            originalLog.apply(console, args);
        };
        
        console.error = function(...args) {
            addLog('error', ...args);
            originalError.apply(console, args);
        };
        
        // Test compilation directly
        window.addEventListener('load', () => {
            addLog('info', 'Testing parser fix...');
            
            // Test 1: "the X of Y" syntax compilation
            try {
                const result1 = hyperfixi.compile('on click set the textContent of #test-element to "test"');
                if (result1.success) {
                    addLog('success', 'TEST 1 PASSED: "the textContent of" syntax compiles successfully');
                } else {
                    addLog('error', 'TEST 1 FAILED: "the textContent of" compilation failed:', result1.errors);
                }
            } catch (e) {
                addLog('error', 'TEST 1 ERROR:', e.message);
            }
            
            // Test 2: "the X of Y" with innerHTML
            try {
                const result2 = hyperfixi.compile('on click set the innerHTML of #element to "<span>test</span>"');
                if (result2.success) {
                    addLog('success', 'TEST 2 PASSED: "the innerHTML of" syntax compiles successfully');
                } else {
                    addLog('error', 'TEST 2 FAILED: "the innerHTML of" compilation failed:', result2.errors);
                }
            } catch (e) {
                addLog('error', 'TEST 2 ERROR:', e.message);
            }
            
            // Test 3: Control test - possessive syntax should still work
            try {
                const result3 = hyperfixi.compile('on click set my textContent to "test"');
                if (result3.success) {
                    addLog('success', 'CONTROL TEST PASSED: possessive syntax still works');
                } else {
                    addLog('error', 'CONTROL TEST FAILED: possessive syntax broken:', result3.errors);
                }
            } catch (e) {
                addLog('error', 'CONTROL TEST ERROR:', e.message);
            }
            
            addLog('info', 'Parser fix tests completed. Check results above.');
        });
    </script>
</body>
</html>